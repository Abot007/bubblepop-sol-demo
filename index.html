<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Crypto Invaders</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      color: #fff;
      font-family: sans-serif;
    }
    #chargeBar {
      position: absolute;
      bottom: 10px;
      left: 10px;
      width: 200px;
      height: 20px;
      background: #333;
      border: 1px solid #fff;
    }
    #chargeFill {
      height: 100%;
      background: lime;
      width: 0%;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="chargeBar">
    <div id="chargeFill"></div>
  </div>

  <script>
    // Get canvas and context
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Game state arrays
    let bullets = [];
    let enemies = [];
    let powerBullets = [];

    // Player object (our meme character)
    const player = {
      x: canvas.width / 2,
      y: canvas.height - 50,
      width: 40,
      height: 40,
      // A simple charge meter for the power-up shot:
      charge: 0,  // ranges from 0 to 100
      chargeRate: 0.05  // amount added per frame (adjust as needed)
    };

    // For spawning enemies
    let enemySpawnTimer = 0;
    const enemySpawnInterval = 100; // frames between spawns

    // Listen for mouse movement
    document.addEventListener("mousemove", function(e) {
      // Constrain the player to canvas bounds
      player.x = Math.min(Math.max(e.clientX, player.width/2), canvas.width - player.width/2);
    });

    // Listen for left-click (fire regular bullet)
    document.addEventListener("click", function(e) {
      fireBullet();
    });

    // Listen for right-click (power-up shot)
    document.addEventListener("contextmenu", function(e) {
      e.preventDefault(); // Prevent context menu from appearing
      firePowerShot();
    });

    // Function to fire a regular bullet
    function fireBullet() {
      bullets.push({
        x: player.x,
        y: player.y - player.height / 2,
        width: 8,
        height: 20,
        speed: 7
      });
    }

    // Function to fire a power-up bullet if charged
    function firePowerShot() {
      if (player.charge >= 100) {
        // Reset charge
        player.charge = 0;
        // Fire a larger, more powerful bullet
        powerBullets.push({
          x: player.x,
          y: player.y - player.height / 2,
          width: 16,
          height: 40,
          speed: 10
        });
      }
    }

    // Game loop
    function update() {
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Update player's charge meter
      if (player.charge < 100) {
        player.charge += player.chargeRate;
        if (player.charge > 100) player.charge = 100;
      }
      document.getElementById("chargeFill").style.width = player.charge + "%";

      // Draw the player (placeholder â€“ you could replace this with an image)
      ctx.fillStyle = "yellow";
      ctx.fillRect(player.x - player.width/2, player.y - player.height/2, player.width, player.height);

      // Spawn enemies (red candlesticks)
      enemySpawnTimer++;
      if (enemySpawnTimer >= enemySpawnInterval) {
        enemySpawnTimer = 0;
        // Enemies spawn at a random X position at the top
        enemies.push({
          x: Math.random() * (canvas.width - 30) + 15,
          y: -20,
          width: 20,
          height: 40,
          speed: 1,   // initial descent speed
          pushed: false  // flag for when hit
        });
      }

      // Update and draw enemies
      for (let i = enemies.length - 1; i >= 0; i--) {
        let enemy = enemies[i];
        // If enemy was hit, push upward faster; otherwise, move downward slowly
        if (enemy.pushed) {
          enemy.y -= 5;
        } else {
          enemy.y += enemy.speed;
        }
        // Draw enemy as a red candlestick
        ctx.fillStyle = "red";
        ctx.fillRect(enemy.x - enemy.width/2, enemy.y - enemy.height/2, enemy.width, enemy.height);

        // Remove enemy if off screen
        if (enemy.y + enemy.height < 0 || enemy.y - enemy.height > canvas.height) {
          enemies.splice(i, 1);
        }
      }

      // Update and draw regular bullets (green candlesticks)
      for (let i = bullets.length - 1; i >= 0; i--) {
        let bullet = bullets[i];
        bullet.y -= bullet.speed;
        ctx.fillStyle = "lime";
        ctx.fillRect(bullet.x - bullet.width/2, bullet.y - bullet.height, bullet.width, bullet.height);
        
        // Remove bullet if off screen
        if (bullet.y + bullet.height < 0) {
          bullets.splice(i, 1);
          continue;
        }
        
        // Check collision with enemies
        for (let j = enemies.length - 1; j >= 0; j--) {
          let enemy = enemies[j];
          if (rectIntersect(bullet, enemy)) {
            // Mark enemy as hit so it gets pushed upward.
            enemy.pushed = true;
            // Remove bullet upon hit
            bullets.splice(i, 1);
            break;
          }
        }
      }

      // Update and draw power-up bullets
      for (let i = powerBullets.length - 1; i >= 0; i--) {
        let pBullet = powerBullets[i];
        pBullet.y -= pBullet.speed;
        ctx.fillStyle = "cyan";
        ctx.fillRect(pBullet.x - pBullet.width/2, pBullet.y - pBullet.height, pBullet.width, pBullet.height);

        // Remove if off screen
        if (pBullet.y + pBullet.height < 0) {
          powerBullets.splice(i, 1);
          continue;
        }

        // Check collision with enemies (power bullet can affect multiple enemies)
        for (let j = enemies.length - 1; j >= 0; j--) {
          let enemy = enemies[j];
          if (rectIntersect(pBullet, enemy)) {
            enemy.pushed = true;
            // Optionally, you could also reduce the power bullet's "power" (or remove it) after hitting a few enemies.
          }
        }
      }

      requestAnimationFrame(update);
    }

    // Simple rectangle collision detection
    function rectIntersect(a, b) {
      return !(a.x + a.width/2 < b.x - b.width/2 ||
               a.x - a.width/2 > b.x + b.width/2 ||
               a.y < b.y - b.height/2 ||
               a.y - a.height > b.y + b.height/2);
    }

    // Start the game loop
    update();

    // Resize canvas on window resize
    window.addEventListener("resize", function() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });
  </script>
</body>
</html>
